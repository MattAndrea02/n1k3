<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>APP_TITLE_PLACEHOLDER</title>

<style>
:root{
  --pink1:#ff4d8d;
  --pink2:#ff86b3;
  --ink:#1a0f16;
  --muted:rgba(0,0,0,.6);
  --radius:22px;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  background: radial-gradient(900px 600px at 20% 10%, #ffe2ef 0%, #fff 55%);
  color:var(--ink);
}

.card{
  width:min(520px,100%);
  background:rgba(255,255,255,.88);
  border-radius:26px;
  box-shadow:0 20px 60px rgba(0,0,0,.15);
  overflow:hidden;
}

header{
  padding:14px 18px;
  background:linear-gradient(90deg,var(--pink1),var(--pink2));
  color:#fff;
  font-weight:800;
}

.content{padding:18px; display:grid; gap:12px;}

input,button{
  padding:14px;
  border-radius:16px;
  font-size:16px;
}

input{border:1px solid #ddd;}
button{border:0; font-weight:900; cursor:pointer}

.primary{
  background:linear-gradient(90deg,var(--pink1),var(--pink2));
  color:#fff;
}
.ghost{
  background:#fff;
  border:1px solid #ccc;
}

.panel{
  background:rgba(255,255,255,.7);
  border-radius:18px;
  padding:12px;
}

.playArea{
  position:relative;
  padding:12px;
  border-radius:18px;
  border:1px solid #ddd;
  background:#fff;
}

/* crossword */
.cwGrid{
  display:grid;
  gap:4px;
  justify-content:center;
}
.cwCell{width:32px;height:32px}
.cwInput{
  width:100%;height:100%;
  text-align:center;
  font-weight:900;
  border-radius:8px;
  border:1px solid #ccc;
}
.blank{visibility:hidden}

/* stages */
#app,#stageCross,#stageNo,#stageFinal{display:none}

/* escape NO */
#btnNo{
  position:absolute;
  left:20px;
  bottom:20px;
}

.big{
  font-size:36px;
  font-weight:900;
  text-align:center;
}
</style>
</head>

<body>
<div class="card">

<header>HEADER_PLACEHOLDER</header>

<div class="content">

<!-- LOGIN -->
<div id="login">
  <div class="panel">Egoriferito, oppure...?</div>
  <input id="pw" placeholder="PASSWORD_INPUT"/>
  <button id="enter" class="primary">ENTRA</button>
</div>

<!-- APP -->
<div id="app">

<!-- CROSSWORD -->
<div id="stageCross" class="playArea">
<div id="cwGrid" class="cwGrid"></div>
<ol id="defs"></ol>
<div id="cwStatus"></div>
</div>

<!-- NO ESCAPE -->
<div id="stageNo" class="playArea">
<div id="question">QUESTION_PLACEHOLDER</div>

<button id="btnMaybe" class="primary">?</button>
<button id="btnNo" class="ghost">NO</button>
</div>

<!-- FINAL -->
<div id="stageFinal" class="playArea">
<div class="big" id="countdown"></div>
<div id="finalText">FINAL_TEXT_PLACEHOLDER</div>

<audio controls>
<source src="song.mp3" type="audio/mpeg">
</audio>
</div>

</div>
</div>

<script>

/******** CONFIG ********/

const PASSWORD="egofrigorifero";
const YES_LINK="https://www.termestufedinerone.it/";
const FINAL_SECONDS=10;

/******** BACKGROUND IMG ********/

const img=new Image();
img.onload=()=>document.body.style.background=`url('background.jpg') center/cover`;
img.src="background.jpg";

/******** LOGIN ********/

enter.onclick=()=>{
 if(pw.value.toLowerCase()===PASSWORD.toLowerCase()){
   login.style.display="none";
   app.style.display="block";
   stageCross.style.display="block";
   initCrossword();
 }
}

/******** CROSSWORD ********/

const rows=5, cols=12;
const solution=new Map();

function place(r,c,w){
 w=w.toUpperCase();
 for(let i=0;i<w.length;i++)
   solution.set(`${r},${c+i}`,w[i]);
}

place(1,5,"LATTE");
place(2,5,"SCII");
place(3,4,"PIRATA");
place(4,7,"MARLEY");
place(5,1,"STEFANO");

const defsData=[
["R1C5","sono un fiocco di ..."],
["R2C5","mi ci sono spaccato il ginocchio"],
["R3C4","lo sarÃ² domenica"],
["R4C7","ha altri 2 mesi di vita"],
["R5C1","mi fa sempre fesso quando parla di soldi"]
];

function initCrossword(){

cwGrid.style.gridTemplateColumns=`repeat(${cols},32px)`;

for(let r=1;r<=rows;r++)
for(let c=1;c<=cols;c++){
 const k=`${r},${c}`;
 const div=document.createElement("div");

 if(solution.has(k)){
  const inp=document.createElement("input");
  inp.className="cwInput";
  inp.maxLength=1;
  inp.dataset.k=k;
  inp.oninput=checkCross;
  div.appendChild(inp);
 }else div.className="blank";

 cwGrid.appendChild(div);
}

defs.innerHTML="";
defsData.forEach((d,i)=>{
 defs.innerHTML+=`<li><b>${i+1}</b> [${d[0]}] ${d[1]}</li>`
});
}

function checkCross(){
 const inputs=document.querySelectorAll(".cwInput");
 let ok=true;

 inputs.forEach(i=>{
  if(i.value.toUpperCase()!==solution.get(i.dataset.k))
    ok=false;
 });

 if(ok){
   stageCross.style.display="none";
   stageNo.style.display="block";
 }
}

/******** NO ESCAPE ********/

let noCount=0;

btnNo.onclick=()=>{
 noCount++;
 btnNo.style.left=Math.random()*200+"px";
 btnNo.style.top=Math.random()*200+"px";
 btnNo.style.bottom="auto";

 if(noCount>=4) btnMaybe.textContent="SI";
}

btnMaybe.onclick=()=>{
 if(btnMaybe.textContent!=="SI") return;

 stageNo.style.display="none";
 stageFinal.style.display="block";
 startCountdown();
}

/******** FINAL ********/

function startCountdown(){
 let t=FINAL_SECONDS;
 countdown.textContent=t;

 const timer=setInterval(()=>{
   t--;
   countdown.textContent=t;
   if(t<=0){
     clearInterval(timer);
     window.open(YES_LINK,"_blank");
   }
 },1000);
}

</script>
</body>
</html>
